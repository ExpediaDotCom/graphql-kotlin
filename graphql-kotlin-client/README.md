# GraphQL Kotlin Client
[![Maven Central](https://img.shields.io/maven-central/v/com.expediagroup/graphql-kotlin-client.svg?label=Maven%20Central)](https://search.maven.org/search?q=g:%22com.expediagroup%22%20AND%20a:%22graphql-kotlin-client%22)
[![Javadocs](https://img.shields.io/maven-central/v/com.expediagroup/graphql-kotlin-client.svg?label=javadoc&colorB=brightgreen)](https://www.javadoc.io/doc/com.expediagroup/graphql-kotlin-client)

A lightweight typesafe GraphQL HTTP client.

NOTE: While you can use the GraphQL client directly by manually creating your corresponding data model, the most common
mode of operation should be through usage of Gradle or Maven plugin and the resulting auto-generated code.

## Installation

Using a JVM dependency manager, simply link graphql-kotlin-client to your project.

With Maven:

```xml
<dependency>
  <groupId>com.expediagroup</groupId>
  <artifactId>graphql-kotlin-federation</artifactId>
  <version>${latestVersion}</version>
</dependency>
```

With Gradle (example using kts):

```kotlin
compile("com.expediagroup:graphql-kotlin-client$latestVersion")
```

## Usage

### Downloading Schema

Before we can auto-generate the data model for our GraphQL queries we first need to obtain a copy of a corresponding
GraphQL schema. Simplest way to do it is by running one of the tasks supplied by GraphQL Kotlin Gradle plugin through
CLI

```bash
./gradlew introspectSchema --endpoint="http://localhost:8080/sdl"
```

This will run introspection query against target GraphQL server and save the resulting schema in `schema.graphql` file
under build directory. GraphQL schemas might be evolving over time so we highly recommend to configure this task to run
as part of your build/release process.

```kotlin
val introspectSchema by tasks.getting(IntrospectSchemaTask::class) {
    endpoint.set("http://localhost:8080/graphql")
}
```

### Writing Queries

When creating your GraphQL queries make sure to always specify operation name and name the files accordingly. Each one
of your query files will result in a generation of a Kotlin file with a class matching your operation name that contains
all your data classes, e.g. given `MyAwesomeGraphQLQuery.graphql` with `myAwesomeQuery` operation name, GraphQL Kotlin
plugins will generate corresponding `MyAwesomeGraphQLQuery.kt` file with `MyAwesomeQuery` class under configured package.

Please refer to our [documentation](https://expediagroup.github.io/graphql-kotlin) for additional details and considerations
while writing your GraphQL queries.

### Generating Client

GraphQL Kotlin build plugins will auto-generate your data classes based on your queries and the underlying GraphQL schema.
In order to generate your client you will need to specify target package name, schema file and queries. If queries parameter
is omitted it will default to look for `*.graphql` files under your resources directory.

```kotlin
val generateClient by tasks.getting(GenerateClientTask::class) {
    packageName.set("com.expediagroup.graphql.generated")
    // use schema file generated by the introspection task
    schemaFile.set(introspectSchema.outputFile)
    // make sure to run client generation after introspection task
    dependsOn("introspectSchema")
}
```

Additional information about Gradle and Maven plugins as well as their respective tasks/mojos can be found in our
[documentation](https://expediagroup.github.io/graphql-kotlin).

### Executing Queries

Your auto generated classes accept an instance of `GraphQLClient` which requires target URL to be specified. `GraphQLClient`
uses Ktor HTTP client to execute the underlying queries and you can specify different engines (defaults to CIO) and
HTTP client features. Please refer to [Ktor HTTP client documentation](https://ktor.io/clients/index.html) for additional
details.

```kotlin
val client = GraphQLClient(url = URL("http://localhost:8080/graphql"))
val query = MyAwesomeQuery(client)
val result = query.myAwesomeQuery()
```

Result of your query is a type safe object that corresponds to your GraphQL query.

Additional information about Gradle and Maven plugins as well as their respective tasks/mojos can be found in our
[documentation](https://expediagroup.github.io/graphql-kotlin).

## Limitations

* Currently only Ktor Http Client is supported, additional clients (e.g. Spring WebClient) might be supported in the future.
* Due to the custom logic required for deserialization of polymorphic types and default enum values only Jackson is currently supported.
* Only single operation per query file is supported.
* Subscriptions are currently not supported.
* Within single GraphQL query you cannot make multiple selections to the same GraphQL object with different fields but it
is perfectly fine to have different selection sets across different GraphQL queries.
* Anonymous operations are supported but will result in generic `AnonymousQuery` (for query operation) class. Plugins
do not keep track of state across different query generations so if you have multiple anonymous operations in a single
package your compilation will fail due to the generic class name collisions.

## Documentation

Additional information can be found in our [documentation](https://expediagroup.github.io/graphql-kotlin) and the
[javadocs](https://www.javadoc.io/doc/com.expediagroup/graphql-kotlin-client) of all published versions.

If you have a question about something you can not find in our documentation or javadocs, feel free to
[create an issue](https://github.com/ExpediaGroup/graphql-kotlin/issues) and tag it with the question label.
